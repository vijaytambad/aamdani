extends ../layout

block content
  .container.mt-4
    .d-flex.justify-content-between.align-items-center.mb-3
      h3 Firms Management
      button.btn.btn-primary(data-bs-toggle="modal", data-bs-target="#addFirmModal") Add Firm

    table.table.table-bordered.table-striped
      thead.table-dark
        tr
          th FirmId
          th Apmcid
          th Prefix
          th Firm Name
          th Action
      tbody
        each firm in firms
          tr
            td(style={'text-align':'right'}) #{firm.firmid}
            td(style={'text-align':'right'}) #{firm.apmcid}
            td(style={'text-align':'left'}) #{firm.prefix}
            td= firm.firmname
            td
              button.btn.btn-sm.btn-warning(
                data-bs-toggle="modal", 
                data-bs-target="#editFirmModal",
                data-firmid=firm.firmid,
                data-apmcid=firm.apmcid,
                data-prefix=firm.prefix,
                data-firmname=firm.firmname
              ) Edit
              button.btn.btn-sm.btn-danger.ms-2(
                data-bs-toggle="modal", 
                data-bs-target="#deleteFirmModal",
                data-firmid=firm.firmid
              ) Delete

  // Add Firm Modal
  .modal.fade#addFirmModal(tabindex="-1")
    .modal-dialog
      .modal-content
        .modal-header
          h5.modal-title Add Firm
          button.btn-close(type="button", data-bs-dismiss="modal")
        .modal-body
          form#addFirmForm(action="/firms/save" method="post")
            .mb-3
              label.form-label(for="firmid") Firm ID
              input.form-control(type="number" name="firmid" required)
            .mb-3
              label.form-label(for="apmcid") APMC ID
              input.form-control(type="number" name="apmcid" required)
            .mb-3
              label.form-label(for="prefix") Prefix
              input.form-control(type="text" name="prefix" required)
            .mb-3
              label.form-label(for="firmname") Firm Name
              input.form-control(type="text" name="firmname" required)
            button.btn.btn-success(type="submit") Save

  // Edit Firm Modal
  .modal.fade#editFirmModal(tabindex="-1")
    .modal-dialog
      .modal-content
        .modal-header
          h5.modal-title Edit Firm
          button.btn-close(type="button", data-bs-dismiss="modal")
        .modal-body
          form#editFirmForm(action="/firms/edit" method="post")
            input(type="hidden" name="firmid" id="edit-firmid")
            .mb-3
              label.form-label(for="edit-apmcid") APMC ID
              input.form-control(type="number" name="apmcid" id="edit-apmcid" required)
            .mb-3
              label.form-label(for="edit-prefix") Prefix
              input.form-control(type="text" name="prefix" id="edit-prefix" required)
            .mb-3
              label.form-label(for="edit-firmname") Firm Name
              input.form-control(type="text" name="firmname" id="edit-firmname" required)
            button.btn.btn-primary(type="submit") Update

  // Delete Firm Modal
  .modal.fade#deleteFirmModal(tabindex="-1")
    .modal-dialog
      .modal-content
        .modal-header
          h5.modal-title Delete Firm
          button.btn-close(type="button", data-bs-dismiss="modal")
        .modal-body
          p.text-danger Are you sure you want to delete this firm?
          form#deleteFirmForm(action="/firms/delete" method="post")
            input(type="hidden" name="firmid" id="delete-firmid")
            button.btn.btn-danger(type="submit") Yes, Delete
            button.btn.btn-secondary(type="button" data-bs-dismiss="modal") Cancel

  script.
    // Populate Edit Modal with data
    var editModal = document.getElementById('editFirmModal')
    editModal.addEventListener('show.bs.modal', function (event) {
      var button = event.relatedTarget
      document.getElementById('edit-firmid').value = button.getAttribute('data-firmid')
      document.getElementById('edit-apmcid').value = button.getAttribute('data-apmcid')
      document.getElementById('edit-prefix').value = button.getAttribute('data-prefix')
      document.getElementById('edit-firmname').value = button.getAttribute('data-firmname')
    })

    // Populate Delete Modal with firmid
    var deleteModal = document.getElementById('deleteFirmModal')
    deleteModal.addEventListener('show.bs.modal', function (event) {
      var button = event.relatedTarget
      document.getElementById('delete-firmid').value = button.getAttribute('data-firmid')
    })
